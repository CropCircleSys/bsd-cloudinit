{"name":"bsd-cloudinit","tagline":"FreeBSD on OpenStack: cloud-init scripts for FreeBSD","body":"## FreeBSD on OpenStack\r\nThere has not been a complete solution to run FreeBSD instances on OpenStack, until now.\r\n\r\nWith bsd-cloudinit and bsd-cloudinit-installer, you could build a FreeBSD VM image that takes advantage of the cloud environment.\r\n\r\n## Components\r\nThe entire project to run FreeBSD on OpenStack is called Feng Li Su (鳳梨酥), a kind of cuboid-shaped sweet Taiwanese pastry with soft crust and pineapple fillings.\r\n\r\nbsd-cloudinit-installer installs bsd-cloudinit, and make `/etc/rc.local` invoke bsd-cloudinit at first boot.\r\n### [bsd-cloudinit](https://github.com/pellaeon/bsd-cloudinit)\r\nbsd-cloudinit is a Python script based on [cloudbase-init](https://github.com/cloudbase/cloudbase-init/) that do various tasks to prepare the FreeBSD instance for cloud environment.\r\n\r\nFeatures:\r\n* Set hostname according to OpenStack's instance name\r\n* Automatic SSH host key generation\r\n* Enlarge root partition to what the flavor provides\r\n* SSH public key injection\r\n* View instances' console message in OpenStack console log\r\n* Self removal after first boot\r\n\r\n### [bsd-cloudinit-installer](https://github.com/pellaeon/bsd-cloudinit-installer)\r\nA shell script to transform VM into OpenStack VM Template and installs bsd-cloudinit\r\n\r\nFeatures:\r\n* Clean SSH host key\r\n* Downloads and install bsd-cloudinit\r\n* Add bsd-cloudinit to `/etc/rc.local`\r\n\r\n## Built image\r\nWe have [experimental built images](http://140.113.98.9/bsd-cloudinit/) available for download.\r\n\r\nYou can use the following command to upload the image to Glance\r\n\r\n    glance image-create --name \"FreeBSD 9.2\" --disk-format qcow2 \\\r\n     --container-format bare < freebsd-9.2-fls-cloudimage-v3.img\r\n\r\nbsd-cloudinit will inject your SSH public key into the instance, just log in with username `freebsd`.\r\n\r\nThe root password is `fenglisu`.\r\n\r\n## Build a FreeBSD VM image for OpenStack\r\nIf you would like to build your own image, follow the guides below.\r\n\r\nbsd-cloudinit-installer is the VM image maker, it transforms a VM into a OpenStack VM image.\r\n\r\n### Install FreeBSD via virt-manager\r\nFirst you'll have to install a normal FreeBSD 9.2 (only 9.2 is tested) VM via virt-manager or similiar tools.\r\n\r\nThe virtual disk size should be as small as possible, so it'll be quicker to deploy and upload. FreeBSD 9.2 requires root partition to be at least 1GB, so you should create a virtual disk slightly larger than 1GB. (We use 1.1GB in our released experimental images.)\r\n\r\nThe **root partition must be the last partition on the disk**, so that bsd-cloudinit could grow the partition on first boot.\r\n\r\nThere should be no need for SWAP. (there is no SWAP in the official Ubuntu cloud images either) But if you want SWAP, always make sure `/` is on the last partition.\r\n\r\nAfter installation completes, do the following actions **as root** to prepare the VM for transformation.\r\n\r\n### Install required Python packages\r\n\r\n    pkg_add -r py27-distribute\r\n    rehash\r\n    easy_install eventlet\r\n    easy_install iso8601\r\n\r\n### VIRTIO\r\nSince 9.2 FreeBSD has VIRTIO drivers built into GENERIC kernel, so just change `ada` to `vtbd` in `/etc/fstab`. It'll pick it up on boot.\r\n\r\n### Output to OpenStack console log\r\n    echo 'console=\"comsonsole,vidconsole\"' >> /boot/loader.conf\r\n### Bootloader menu delay\r\n    echo 'autoboot_delay=\"1\"' >> /boot/loader.conf\r\n### Download and execute bsd-cloudinit-installer\r\n    fetch https://raw.github.com/pellaeon/bsd-cloudinit-installer/master/installer.sh\r\n    chmod +x installer.sh\r\n    ./installer.sh\r\n\r\nAfter this step, the VM is no longer a normal VM and not suitable for use with virt-manager.\r\n\r\nFollow instruction of the installer to clean command history.\r\n\r\nShutdown\r\n\r\n    shutdown -p now\r\n\r\nAfter shutting down, the VM's virtual disk is ready to be deployed in OpenStack, just upload it to Glance\r\n\r\n    glance image-create --name \"FreeBSD 9.2\" --disk-format qcow2 \\\r\n     --container-format bare < freebsd-9.2-fls-cloudimage-v3.img\r\n\r\nThen the image is ready to be deployed! Launch an instance to test it!\r\n\r\n## Planned Features\r\n* insert customization script\r\n* `ntpdate` on first boot\r\n* commandline options for the installer\r\n* install `sudo` and remove hardcoded `root` password\r\n\r\n## Authors and Contributors\r\nbsd-cloudinit is built by @pellaeon, @apua, @iblis17 from Information Technology Service Center\r\n of National Chiao Tung University in Taiwan.\r\n\r\n@pellaeon is the maintainer and takes care of the documentation, planning, coordinating, communications with users.\r\n\r\n@iblis17 takes care of the shell script parts.\r\n\r\n@apua takes care of the Python bits.\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}